<!doctype html>
<html lang="ar" dir="rtl" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#10b981" />
  <title>ุชุทุจูู ุชูุงุนูู ูููุณูุฉ</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com">
    // Back to portal
    $("btnBack")?.addEventListener("click", () => {
      const ref = document.referrer || "";
      try {
        if (ref) {
          const u = new URL(ref);
          if (u.host === window.location.host) {
            window.location.href = ref;
            return;
          }
        }
      } catch {}
      const portalUrl = (document.body.getAttribute("data-portal-url") || "").trim();
      if (portalUrl) {
        window.location.href = portalUrl;
        return;
      }
      if (window.history.length > 1) {
        window.history.back();
        return;
      }
      toast("ูุง ููุฌุฏ ุตูุญุฉ ุณุงุจูุฉ ููุฑุฌูุน ุฅูููุง.");
    });

  </script>

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

  <style>
    :root{ --ring: rgba(16,185,129,.35); }
    body{ font-family:'Tajawal',system-ui,-apple-system,Segoe UI,Roboto,Arial; }
    .glass{ background: rgba(255,255,255,.72); backdrop-filter: blur(10px); }
    .shadow-soft{ box-shadow: 0 16px 50px rgba(2,6,23,.10); }
    .blob{ filter: blur(40px); opacity:.55; }
    .focus-ring:focus{ outline: none; box-shadow: 0 0 0 4px var(--ring); }
    .no-select{ user-select:none; }
    /* scrollbar */
    ::-webkit-scrollbar{ width: 10px; height: 10px; }
    ::-webkit-scrollbar-thumb{ background: rgba(15,23,42,.18); border-radius: 999px; }
    ::-webkit-scrollbar-thumb:hover{ background: rgba(15,23,42,.28); }
  </style>
</head>

<body data-portal-url="" class="min-h-screen bg-gradient-to-b from-emerald-50 via-sky-50 to-amber-50 text-slate-800">
  <!-- Decorative blobs -->
  <div aria-hidden="true" class="fixed inset-0 -z-10 overflow-hidden">
    <div class="blob absolute -top-20 -right-24 w-96 h-96 rounded-full bg-emerald-300"></div>
    <div class="blob absolute top-52 -left-24 w-[28rem] h-[28rem] rounded-full bg-sky-300"></div>
    <div class="blob absolute bottom-[-6rem] right-12 w-[30rem] h-[30rem] rounded-full bg-amber-300"></div>
  </div>

  <!-- Top bar -->
  <header class="sticky top-0 z-30 border-b border-white/40 bg-white/55 backdrop-blur">
    <div class="mx-auto max-w-6xl px-4 py-3 flex items-center gap-3">
      <div class="flex items-center gap-3">
        <img src="./assets/logo.jpg" alt="ุดุนุงุฑ ุงูููุชูู" class="w-12 h-12 rounded-2xl object-cover ring-1 ring-black/5 shadow-sm bg-white" />
        <div class="leading-tight">
          <h1 class="text-lg sm:text-xl font-extrabold">ุชุทุจูู ุชูุงุนูู ูููุณูุฉ</h1>
          <p class="text-xs sm:text-sm text-slate-600">ุงุฎุชุฑ ูุดุงุทูุงุ ูุงูุชุญู ูุจุงุดุฑุฉ โ ูุน ุจุญุซ ูููุถูุฉ ููุชุงุจุนุฉ ููุฒูุงุฑุงุช.</p>
        </div>
      </div>

      <div class="ms-auto flex items-center gap-2">
        
        <button id="btnBack" class="btn inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-white border border-slate-200 text-slate-700 text-sm hover:shadow-soft" title="ุงูุฑุฌูุน ููุจูุงุจุฉ">
          <span class="text-base">๐</span>
          <span class="hidden sm:inline">ุงูุฑุฌูุน ููุจูุงุจุฉ</span>
        </button>
<button id="btnHelp" class="focus-ring rounded-xl px-3 py-2 text-sm font-bold bg-white/70 hover:bg-white shadow-sm border border-white/60">
          ุฅุฑุดุงุฏุงุช
        </button>
        <a href="#links" class="focus-ring rounded-xl px-3 py-2 text-sm font-bold text-white bg-emerald-600 hover:bg-emerald-700 shadow-sm">
          ุงุจุฏุฃ ุงูุขู
        </a>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="mx-auto max-w-6xl px-4 py-8">
    <!-- Hero -->
    <section class="relative overflow-hidden rounded-3xl border border-white/55 glass shadow-soft p-6 sm:p-8">
      <div class="flex flex-col md:flex-row md:items-center gap-6">
        <div class="flex-1">
          <div class="inline-flex items-center gap-2 rounded-full bg-emerald-600/10 text-emerald-800 px-3 py-1 text-xs font-bold">
            <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
            ููุญุฉ ุฑูุงุจุท ุชุนููููุฉ โ ุงููุณูุฉ
          </div>

          <h2 class="mt-3 text-2xl sm:text-3xl font-extrabold">
            ูู ุฃูุนุงุจ ูุชูุงุฑูู ุงููุณูุฉ ูู ููุงู ูุงุญุฏ โจ
          </h2>

          <p class="mt-2 text-slate-700 leading-relaxed">
            ุงุณุชุฎุฏู ุงูุจุญุซ ุฃู ุงุฎุชุฑ ุชุตููููุงุ ุซู ุงูุชุญ ุงูุชุทุจูู ุงูุฐู ุชุฑูุฏู. ููููู ุฅุถุงูุฉ ุฃู ุฑุงุจุท ููููุถูุฉ โญ
            ูุณูุญูุธ ุงูุชุทุจูู ุชูุฏูู ุนูู ููุณ ุงูุฌูุงุฒ ุชููุงุฆููุง.
          </p>

          <div class="mt-5 grid grid-cols-2 sm:grid-cols-4 gap-3">
            <div class="rounded-2xl bg-white/75 border border-white/60 p-3">
              <div class="text-xs text-slate-500 font-bold">ุนุฏุฏ ุงูุฑูุงุจุท</div>
              <div id="statTotal" class="text-xl font-extrabold mt-1">โ</div>
            </div>
            <div class="rounded-2xl bg-white/75 border border-white/60 p-3">
              <div class="text-xs text-slate-500 font-bold">ุชูุช ุฒูุงุฑุชูุง</div>
              <div id="statVisited" class="text-xl font-extrabold mt-1">โ</div>
            </div>
            <div class="rounded-2xl bg-white/75 border border-white/60 p-3">
              <div class="text-xs text-slate-500 font-bold">ุงูููุถูุฉ</div>
              <div id="statFav" class="text-xl font-extrabold mt-1">โ</div>
            </div>
            <div class="rounded-2xl bg-white/75 border border-white/60 p-3">
              <div class="text-xs text-slate-500 font-bold">ุขุฎุฑ ุฒูุงุฑุฉ</div>
              <div id="statLast" class="text-sm font-extrabold mt-2 leading-tight">โ</div>
            </div>
          </div>
        </div>

        <div class="md:w-[22rem]">
          <div class="rounded-3xl bg-gradient-to-br from-emerald-600 to-sky-600 text-white p-5 shadow-soft">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-2xl bg-white/15 flex items-center justify-center text-xl">โ</div>
              <div>
                <div class="font-extrabold">ูุตูุญุฉ ุณุฑูุนุฉ</div>
                <div class="text-sm text-white/90">ุงุจุฏุฃ ุจุงููุณูุฉ ุนูู ูข ุจุงูุชูุซูู ุงูุญุณูุ ุซู ุงูุชูู ููุชุฏุฑูุจุงุช.</div>
              </div>
            </div>
            <div class="mt-4 rounded-2xl bg-white/10 p-4 text-sm leading-relaxed">
              ุฌุฑูุจ ุชุฑุชูุจ ุงูุชุนูู:
              <div class="mt-2 flex flex-wrap gap-2">
                <span class="px-3 py-1 rounded-full bg-white/15">ุชูุซูู ุญุณู</span>
                <span class="px-3 py-1 rounded-full bg-white/15">ุชูุฒูุน ุจุงูุชุณุงูู</span>
                <span class="px-3 py-1 rounded-full bg-white/15">ุชุฏุฑูุจ + ุชุบุฐูุฉ ุฑุงุฌุนุฉ</span>
                <span class="px-3 py-1 rounded-full bg-white/15">ุชุญูู ุจุงูุถุฑุจ</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Controls -->
    <section id="links" class="mt-8">
      <div class="flex flex-col lg:flex-row lg:items-center gap-3">
        <div class="flex-1">
          <label class="block text-sm font-extrabold text-slate-700 mb-2" for="q">ุจุญุซ ุณุฑูุน</label>
          <div class="relative">
            <input id="q" class="focus-ring w-full rounded-2xl border border-white/60 bg-white/70 px-4 py-3 pr-11 shadow-soft"
              placeholder="ุงุจุญุซ ุจุงูุงุณู ุฃู ุงููุตู ุฃู ุงูุชุตูููโฆ"
              autocomplete="off" />
            <div class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-500">๐</div>
          </div>
        </div>

        <div class="lg:w-[18rem]">
          <label class="block text-sm font-extrabold text-slate-700 mb-2" for="filter">ุชุตููุฉ</label>
          <select id="filter" class="focus-ring w-full rounded-2xl border border-white/60 bg-white/70 px-4 py-3 shadow-soft">
            <option value="all">ูู ุงูุฑูุงุจุท</option>
            <option value="fav">ุงูููุถูุฉ โญ</option>
            <option value="visited">ุชูุช ุฒูุงุฑุชูุง โ</option>
            <option value="unvisited">ูู ุชูุฒุฑ ุจุนุฏ</option>
          </select>
        </div>
      </div>

      <div class="mt-4">
        <div class="flex items-center justify-between gap-3 flex-wrap">
          <div>
            <div class="text-sm font-extrabold text-slate-700 mb-2">ุงูุชุตูููุงุช</div>
            <div id="chips" class="flex flex-wrap gap-2"></div>
          </div>

          <div class="flex items-center gap-2">
            <button id="btnReset" class="focus-ring rounded-2xl px-4 py-2 bg-white/70 hover:bg-white border border-white/60 font-extrabold text-sm shadow-soft">
              ุฅุนุงุฏุฉ ุถุจุท
            </button>
            <button id="btnClear" class="focus-ring rounded-2xl px-4 py-2 bg-rose-600 hover:bg-rose-700 text-white font-extrabold text-sm shadow-soft">
              ูุณุญ ุงูุชูุฏูู
            </button>
          </div>
        </div>

        <p id="resultHint" class="mt-3 text-sm text-slate-600"></p>
      </div>

      <!-- Cards grid -->
      <div id="grid" class="mt-5 grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4"></div>
    </section>

    <!-- Help modal -->
    <div id="helpModal" class="fixed inset-0 z-50 hidden">
      <div class="absolute inset-0 bg-black/35"></div>
      <div class="absolute inset-0 flex items-end sm:items-center justify-center p-4">
        <div class="w-full max-w-2xl rounded-3xl bg-white shadow-soft border border-white/60 overflow-hidden">
          <div class="p-5 sm:p-6 border-b bg-slate-50">
            <div class="flex items-center gap-2">
              <div class="text-xl">๐</div>
              <h3 class="text-lg font-extrabold">ุฅุฑุดุงุฏุงุช ุณุฑูุนุฉ</h3>
              <button id="btnCloseHelp" class="ms-auto focus-ring rounded-xl px-3 py-2 text-sm font-bold bg-white hover:bg-white border border-slate-200">
                ุฅุบูุงู
              </button>
            </div>
          </div>
          <div class="p-5 sm:p-6 text-sm leading-relaxed text-slate-700">
            <ul class="list-disc pr-5 space-y-2">
              <li>ุงุถุบุท <b>ูุชุญ</b> ูุฒูุงุฑุฉ ุงููุดุงุท ูู ุชุจููุจ ุฌุฏูุฏ.</li>
              <li>ุงุถุบุท โญ ูุฅุถุงูุฉ ุงูุฑุงุจุท ุฅูู <b>ุงูููุถูุฉ</b>.</li>
              <li>ุณูุชู ุญูุธ <b>ุงูุฒูุงุฑุงุช</b> ู<b>ุงูููุถูุฉ</b> ุชููุงุฆููุง ุนูู ููุณ ุงูุฌูุงุฒ (ุจุฏูู ุฃู ุชุณุฌูู ุฏุฎูู).</li>
              <li>ุงุณุชุฎุฏู ุงูุจุญุซ ูุงูุชุตูููุงุช ูุชุตู ุจุณุฑุนุฉ ูููุน ุงููุดุงุท ุงูุฐู ุชุฑูุฏู.</li>
              <li>ุฒุฑ <b>ูุณุญ ุงูุชูุฏูู</b> ููุณุญ ุงูุฒูุงุฑุงุช ูุงูููุถูุฉ ูู ูุฐุง ุงูุฌูุงุฒ ููุท.</li>
            </ul>

            <div class="mt-4 rounded-2xl bg-emerald-50 border border-emerald-100 p-4">
              <div class="font-extrabold text-emerald-800">ููุงุญุธุฉ</div>
              <div class="mt-1 text-emerald-800/90">
                ุงูุฑูุงุจุท ุชุนูู ุนุจุฑ HTTPS ูุชูุชุญ ูู GitHub Pages. ุฅุฐุง ุฑุบุจุช ุชุถูู ุฑูุงุจุท ุฌุฏูุฏุฉุ ููุท ุญุฏูุซ ูุงุฆูุฉ ุงูุฑูุงุจุท ุฏุงุฎู ููู <code>index.html</code>.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-24 left-1/2 -translate-x-1/2 z-50 hidden">
      <div class="rounded-2xl bg-slate-900 text-white px-4 py-3 shadow-soft text-sm font-bold">
        ุชู โ
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="mt-10 border-t border-white/40 bg-white/55 backdrop-blur">
    <div class="mx-auto max-w-6xl px-4 py-5 flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3">
      <div class="font-extrabold text-slate-700">ุฃ/ ูุงุทูุฉ ูุฒุงุฒู</div>
      <div class="text-slate-500 hidden sm:block">โข</div>
      <div class="font-bold text-slate-600">ููุชูู ูุนููู ููุนููุงุช ุงูุฑูุงุถูุงุช</div>
      <div class="text-slate-500 hidden sm:block">โข</div>
      <div class="font-bold text-slate-600">ููุชูู ุงูุชุนููู ุงูุชูุงุนูู</div>
      <div class="ms-auto text-xs text-slate-500">ยฉ <span id="year"></span></div>
    </div>
  </footer>

<script>
/* ========= Data ========= */
const LINKS = [
  {
    id: "balance",
    title: "ูุนุจุฉ ุงูููุฒุงู โ ุงููุณูุฉ ุนูู ูข (ุชูุซูู ุญุณู)",
    desc: "ุชูููุฉ ููู ุงููุณูุฉ ุนูู ูข ุนุจุฑ ุชูุฒูุน ุงูููุงูู ุจุงูุชุณุงูู ุนูู ููุชู ุงูููุฒุงู.",
    url: "https://123456789fh.github.io/The-Balance-Game/",
    category: "ุงููุณูุฉ ุนูู ูข",
    tags: ["ูุนุจุฉ", "ุชูุซูู ุญุณู", "ุชูุฒูุน ุจุงูุชุณุงูู"]
  },
  {
    id: "activity",
    title: "ููููู ุงููุณูุฉ โ ุงูุชูุฒูุน ุจุงูุชุณุงูู",
    desc: "ูุดุงุท ุชูุงุนูู ูุฑุณูุฎ ููููู ุงููุณูุฉ ุจุงุนุชุจุงุฑูุง ุชูุฒูุนูุง ุจุงูุชุณุงูู.",
    url: "https://123456789fh.github.io/Activity/",
    category: "ููููู ุงููุณูุฉ",
    tags: ["ูุดุงุท", "ููููู", "ุชูุฒูุน ุจุงูุชุณุงูู"]
  },
  {
    id: "package2",
    title: "ุจุงูุฉ ุฃูุนุงุจ ุงููุณูุฉ ุนูู ูข",
    desc: "ูุฌููุนุฉ ุฃูุนุงุจ ูุชููุนุฉ ูุชุซุจูุช ุงููุณูุฉ ุนูู ูข ุจูุณุชููุงุช ูุฎุชููุฉ.",
    url: "https://123456789fh.github.io/Game-Package/",
    category: "ุงููุณูุฉ ุนูู ูข",
    tags: ["ุจุงูุฉ ุฃูุนุงุจ", "ุชุฏุฑูุฌ", "ูุฑุญ"]
  },
  {
    id: "assistant",
    title: "ูุณุงุนุฏ ุงููุณูุฉ ููุฃุทูุงู",
    desc: "ููู ุจุตุฑู ูุนููู ุนุจุฑ ุงููุนุจ + ุชุฏุฑูุจ ูุชุบุฐูุฉ ุฑุงุฌุนุฉ + ุดุฑุญ ุงูุทุฑุญ ุงููุชูุฑุฑ ูุงูุชุญูู ุจุงูุถุฑุจ.",
    url: "https://123456789fh.github.io/Assistant-in-division/",
    category: "ููุงุฑุงุช ุงููุณูุฉ",
    tags: ["ุชุบุฐูุฉ ุฑุงุฌุนุฉ", "ุทุฑุญ ูุชูุฑุฑ", "ุชุญูู ุจุงูุถุฑุจ"]
  },
  {
    id: "facts",
    title: "ุนูุงูุฉ ุงููุณูุฉ ุจุงูุถุฑุจ",
    desc: "ุดุจูุฉ ุญูุงุฆู ูุชุฑุงุจุทุฉ ุชูุถุญ ููู ูุชุญูู ูู ุงููุณูุฉ ุจุงุณุชุฎุฏุงู ุงูุถุฑุจ.",
    url: "https://123456789fh.github.io/Networks-interconnected-facts/",
    category: "ุนูุงูุฉ ุงููุณูุฉ ุจุงูุถุฑุจ",
    tags: ["ุชุญูู", "ุญูุงุฆู", "ุถุฑุจ ููุณูุฉ"]
  },
  {
    id: "div2",
    title: "ุชุนูู ุงููุณูุฉ ุนูู ูข",
    desc: "ุชูุฒูุน ุจุงูุชุณุงูู ุจูู ุดุฎุตูู + ุฃูุซูุฉ ุชูุงุนููุฉ + ุฎูุงุฑุงุช ุฅุฌุงุจุฉ + ุดุฑุญ ููุฑู ุฎุทูุฉ ุจุฎุทูุฉ.",
    url: "https://123456789fh.github.io/Division-by-2/",
    category: "ุงููุณูุฉ ุนูู ูข",
    tags: ["ุดุฑุญ", "ุฎุทูุฉ ุจุฎุทูุฉ", "ูุณุชููุงุช"]
  },
  {
    id: "maze2",
    title: "ูุนุจุฉ ุงููุชุงูุฉ โ ุงููุณูุฉ ุนูู ูข",
    desc: "ูุชุงูุฉ ุชุนููููุฉ ููุชุนุฉ ูุชุทุจูู ุงููุณูุฉ ุนูู ูข ูุน ุชุญุฏูุงุช ุณุฑูุนุฉ.",
    url: "https://123456789fh.github.io/Maze-Game-/",
    category: "ุงููุณูุฉ ุนูู ูข",
    tags: ["ูุชุงูุฉ", "ุชุญุฏู", "ูุนุจุฉ"]
  },
  {
    id: "div89",
    title: "ุงููุณูุฉ ุนูู ูจ ููฉ",
    desc: "ุชุฏุฑูุจุงุช ุชูุงุนููุฉ ุนูู ุงููุณูุฉ ุนูู ูจ ููฉ ุจุฃุณุฆูุฉ ูุชููุนุฉ.",
    url: "https://123456789fh.github.io/Division-by-9-8/",
    category: "ููุงุนุฏ ุงููุณูุฉ",
    tags: ["ุชุฏุฑูุจ", "ูจ", "ูฉ"]
  },
  {
    id: "div67",
    title: "ุงููุณูุฉ ุนูู ูฆ ููง",
    desc: "ุชุฏุฑูุจุงุช ุชูุงุนููุฉ ุนูู ุงููุณูุฉ ุนูู ูฆ ููง ุจุฃุณุฆูุฉ ูุชููุนุฉ.",
    url: "https://123456789fh.github.io/Division-by-7-6/",
    category: "ููุงุนุฏ ุงููุณูุฉ",
    tags: ["ุชุฏุฑูุจ", "ูฆ", "ูง"]
  },
  {
    id: "review7",
    title: "ูุฑุงุฌุนุฉ ูุตู ูง",
    desc: "ูุฑุงุฌุนุฉ ูุฑููุฒุฉ ูููุงุฑุงุช ุงููุตู ุงูุณุงุจุน ูุน ุชูุงุฑูู ูุชููุนุฉ.",
    url: "https://123456789fh.github.io/Review/",
    category: "ูุฑุงุฌุนุฉ",
    tags: ["ูุฑุงุฌุนุฉ", "ุชูุงุฑูู", "ุชูููู"]
  },
  {
    id: "test1",
    title: "ุงุฎุชุจุงุฑ ูก โ ุงููุณูุฉ",
    desc: "ุงุฎุชุจุงุฑ ุชุฏุฑูุจู ุณุฑูุน ูููุงุณ ุฅุชูุงู ููุงุฑุงุช ุงููุณูุฉ.",
    url: "https://123456789fh.github.io/Training/",
    category: "ุงุฎุชุจุงุฑุงุช",
    tags: ["ุงุฎุชุจุงุฑ", "ููุงุณ", "ุชุฏุฑูุจ"]
  }
];

/* ========= Storage ========= */
const KEY = "division_links_state_v1";
function loadState(){
  try{
    const raw = localStorage.getItem(KEY);
    if(!raw) return { visited:{}, fav:{} };
    const obj = JSON.parse(raw);
    return { visited: obj.visited || {}, fav: obj.fav || {} };
  }catch(e){
    return { visited:{}, fav:{} };
  }
}
function saveState(state){
  localStorage.setItem(KEY, JSON.stringify(state));
}

/* ========= Helpers ========= */
const arDigits = (n) => String(n).replace(/[0-9]/g, d => "ููกูขูฃูคูฅูฆูงูจูฉ"[d]);
const formatDateAr = (ts) => {
  if(!ts) return "โ";
  try{
    const d = new Date(ts);
    const s = d.toLocaleString("ar-SA", { weekday:"short", year:"numeric", month:"short", day:"numeric", hour:"2-digit", minute:"2-digit" });
    return s;
  }catch(e){ return "โ"; }
};

function toast(msg="ุชู โ"){
  const el = document.getElementById("toast");
  el.querySelector("div").textContent = msg;
  el.classList.remove("hidden");
  clearTimeout(window.__t);
  window.__t = setTimeout(()=> el.classList.add("hidden"), 1600);
}

function copy(text){
  navigator.clipboard.writeText(text).then(()=>toast("ุชู ุงููุณุฎ โ")).catch(()=>toast("ุชุนุฐุฑ ุงููุณุฎ"));
}

/* ========= UI State ========= */
let state = loadState();
let activeCategory = "ุงููู";

/* ========= DOM ========= */
const q = document.getElementById("q");
const filter = document.getElementById("filter");
const grid = document.getElementById("grid");
const chips = document.getElementById("chips");
const hint = document.getElementById("resultHint");

function buildChips(){
  const cats = ["ุงููู", ...Array.from(new Set(LINKS.map(x=>x.category)))];
  chips.innerHTML = "";
  cats.forEach(cat=>{
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = chipClass(cat === activeCategory);
    btn.textContent = cat;
    btn.addEventListener("click", ()=>{
      activeCategory = cat;
      buildChips();
      render();
    });
    chips.appendChild(btn);
  });
}

function chipClass(active){
  return [
    "focus-ring no-select rounded-full px-4 py-2 text-sm font-extrabold border shadow-soft",
    active ? "bg-emerald-600 text-white border-emerald-600" : "bg-white/70 hover:bg-white border-white/60 text-slate-700"
  ].join(" ");
}

function updateStats(){
  const total = LINKS.length;
  const visited = Object.keys(state.visited || {}).length;
  const fav = Object.keys(state.fav || {}).length;
  const last = state.lastVisited || null;

  document.getElementById("statTotal").textContent = arDigits(total);
  document.getElementById("statVisited").textContent = arDigits(visited);
  document.getElementById("statFav").textContent = arDigits(fav);
  document.getElementById("statLast").textContent = formatDateAr(last);

  document.getElementById("year").textContent = new Date().getFullYear();
}

function isVisited(id){ return !!state.visited[id]; }
function isFav(id){ return !!state.fav[id]; }

function toggleFav(id){
  if(isFav(id)) delete state.fav[id];
  else state.fav[id] = Date.now();
  saveState(state);
  updateStats();
  render();
}

function markVisited(id){
  state.visited[id] = Date.now();
  state.lastVisited = Date.now();
  saveState(state);
  updateStats();
  render();
}

function openLink(item){
  markVisited(item.id);
  window.open(item.url, "_blank", "noopener,noreferrer");
}

function matches(item, query){
  if(!query) return true;
  const hay = (item.title + " " + item.desc + " " + item.category + " " + (item.tags||[]).join(" ")).toLowerCase();
  return hay.includes(query.toLowerCase());
}

function applyFilter(items){
  const f = filter.value;
  if(f === "fav") return items.filter(x=>isFav(x.id));
  if(f === "visited") return items.filter(x=>isVisited(x.id));
  if(f === "unvisited") return items.filter(x=>!isVisited(x.id));
  return items;
}

function applyCategory(items){
  if(activeCategory === "ุงููู") return items;
  return items.filter(x=>x.category === activeCategory);
}

function render(){
  const query = q.value.trim();
  let items = LINKS.slice();
  items = applyCategory(items);
  items = applyFilter(items);
  items = items.filter(x=>matches(x, query));

  // Hint
  const txt = `ูุนุฑุถ ุงูุขู: ${arDigits(items.length)} ูู ${arDigits(LINKS.length)} ุฑุงุจุท`;
  hint.textContent = txt;

  grid.innerHTML = "";
  if(items.length === 0){
    grid.innerHTML = `
      <div class="sm:col-span-2 xl:col-span-3">
        <div class="rounded-3xl border border-white/60 bg-white/70 p-6 shadow-soft text-center">
          <div class="text-3xl">๐</div>
          <div class="mt-2 font-extrabold">ูุง ุชูุฌุฏ ูุชุงุฆุฌ ูุทุงุจูุฉ</div>
          <div class="mt-1 text-sm text-slate-600">ุฌุฑูุจ ุชูููู ูููุงุช ุงูุจุญุซ ุฃู ุงุฎุชุฑ โูู ุงูุฑูุงุจุทโ.</div>
        </div>
      </div>
    `;
    return;
  }

  items.forEach(item=>{
    const card = document.createElement("div");
    const visited = isVisited(item.id);
    const fav = isFav(item.id);

    card.className = "rounded-3xl border border-white/60 bg-white/70 shadow-soft overflow-hidden hover:translate-y-[-2px] transition-transform";
    card.innerHTML = `
      <div class="p-5">
        <div class="flex items-start gap-3">
          <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-emerald-600 to-sky-600 text-white flex items-center justify-center text-xl shadow-sm">โ</div>
          <div class="flex-1">
            <div class="flex items-center gap-2 flex-wrap">
              <h3 class="font-extrabold text-base leading-snug">${item.title}</h3>
              ${visited ? `<span class="px-2 py-1 rounded-full text-xs font-extrabold bg-emerald-600/10 text-emerald-800 border border-emerald-100">ุชูุช ุฒูุงุฑุชูุง โ</span>` : ``}
            </div>
            <div class="mt-1 text-sm text-slate-700 leading-relaxed">${item.desc}</div>
            <div class="mt-3 flex flex-wrap gap-2">
              <span class="px-3 py-1 rounded-full text-xs font-extrabold bg-slate-900/5 border border-white/60">${item.category}</span>
              ${(item.tags||[]).slice(0,3).map(t=>`<span class="px-3 py-1 rounded-full text-xs font-bold bg-white/70 border border-white/60">${t}</span>`).join("")}
            </div>
          </div>
        </div>

        <div class="mt-4 grid grid-cols-3 gap-2">
          <button class="btnOpen focus-ring col-span-2 rounded-2xl px-4 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-extrabold">
            ูุชุญ
          </button>

          <button class="btnFav focus-ring rounded-2xl px-3 py-3 bg-white/80 hover:bg-white border border-white/60 font-extrabold">
            ${fav ? "โ" : "โ"}
          </button>

          <button class="btnCopy focus-ring col-span-2 rounded-2xl px-4 py-3 bg-white/80 hover:bg-white border border-white/60 font-extrabold">
            ูุณุฎ ุงูุฑุงุจุท
          </button>

          <button class="btnMark focus-ring rounded-2xl px-3 py-3 bg-white/80 hover:bg-white border border-white/60 font-extrabold">
            โ
          </button>
        </div>

        <div class="mt-3 text-xs text-slate-500 break-all">${item.url}</div>
      </div>
    `;

    card.querySelector(".btnOpen").addEventListener("click", ()=> openLink(item));
    card.querySelector(".btnFav").addEventListener("click", ()=> toggleFav(item.id));
    card.querySelector(".btnCopy").addEventListener("click", ()=> copy(item.url));
    card.querySelector(".btnMark").addEventListener("click", ()=>{
      markVisited(item.id);
      toast("ุชู ุชุณุฌูู ุงูุฒูุงุฑุฉ โ");
    });

    grid.appendChild(card);
  });
}

function resetUI(){
  q.value = "";
  filter.value = "all";
  activeCategory = "ุงููู";
  buildChips();
  render();
}

document.getElementById("btnReset").addEventListener("click", resetUI);
document.getElementById("btnClear").addEventListener("click", ()=>{
  if(confirm("ูู ุชุฑูุฏ ูุณุญ ุงูุฒูุงุฑุงุช ูุงูููุถูุฉ ูู ูุฐุง ุงูุฌูุงุฒุ")){
    state = { visited:{}, fav:{} };
    localStorage.removeItem(KEY);
    updateStats();
    render();
    toast("ุชู ูุณุญ ุงูุชูุฏูู โ");
  }
});

q.addEventListener("input", ()=> render());
filter.addEventListener("change", ()=> render());

/* ========= Help modal ========= */
const help = document.getElementById("helpModal");
document.getElementById("btnHelp").addEventListener("click", ()=> help.classList.remove("hidden"));
document.getElementById("btnCloseHelp").addEventListener("click", ()=> help.classList.add("hidden"));
help.addEventListener("click", (e)=>{ if(e.target === help) help.classList.add("hidden"); });

/* ========= Init ========= */
buildChips();
updateStats();
render();
</script>
</body>
</html>
